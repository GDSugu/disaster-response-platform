<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Disaster Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <h1>🆘 Disaster List</h1>
  <div>
    <input id="tagInput" placeholder="Filter by tag (e.g. flood)" class="form-control w-50 d-inline" />
    <button onclick="loadDisasters()" class="btn btn-primary ms-2">Search</button>
    <a href="create.html" class="btn btn-success float-end">+ New Disaster</a>
  </div>
  <hr/>
  <div id="disasterList" class="mt-3"></div>

  <script src="config.js"></script>
  <script>
    async function loadDisasters() {
      const tag = document.getElementById("tagInput").value;
      const url = tag ? `${API_BASE}/disasters?tag=${tag}` : `${API_BASE}/disasters`;
      const res = await fetch(url);
      const data = await res.json();

      const list = document.getElementById("disasterList");
      list.innerHTML = "";
      data.forEach(d => {
        list.innerHTML += `
          <div class="card mb-2">
            <div class="card-body">
              <h5>${d.title}</h5>
              <p>${d.description}</p>
              <small>📍 ${d.location_name} — 🏷️ ${d.tags.join(', ')}</small><br/>
              <a href="verify.html?id=${d.id}" class="btn btn-sm btn-warning mt-2">Verify Image</a>
              <a href="#" onclick="viewSocial(${d.id})" class="btn btn-sm btn-info mt-2">Social Media</a>
            </div>
          </div>`;
      });
    }

    async function viewSocial(id) {
      const res = await fetch(`${API_BASE}/disasters/${id}/social-media`);
      const data = await res.json();
      alert("Mock Social Media:\n" + data.reports.map(p => p.post).join("\n\n"));
    }

    loadDisasters();
  </script>
</body>
</html>
